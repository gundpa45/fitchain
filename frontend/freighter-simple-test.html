<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üöÄ Simple Freighter Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #0a1929, #1e3a8a);
        color: white;
        padding: 2rem;
        margin: 0;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      .container {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        padding: 2rem;
        max-width: 500px;
        width: 100%;
        text-align: center;
        border: 1px solid rgba(212, 175, 55, 0.3);
      }
      h1 {
        background: linear-gradient(135deg, #d4af37, #ffd700);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 2rem;
      }
      .btn {
        background: linear-gradient(135deg, #d4af37, #ffd700);
        border: none;
        color: #0a1929;
        padding: 1rem 2rem;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        margin: 0.5rem;
        transition: all 0.2s ease;
        min-width: 200px;
      }
      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
      }
      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }
      .status {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 8px;
        padding: 1rem;
        margin: 1rem 0;
        font-family: "Courier New", monospace;
        text-align: left;
        white-space: pre-wrap;
      }
      .success {
        color: #10b981;
      }
      .error {
        color: #ef4444;
      }
      .warning {
        color: #f59e0b;
      }
      .info {
        color: #3b82f6;
      }
      .connected {
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid rgba(16, 185, 129, 0.3);
        border-radius: 8px;
        padding: 1rem;
        margin: 1rem 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üöÄ Simple Freighter Connection Test</h1>

      <div id="status" class="status">
        Ready to test Freighter connection...
      </div>

      <div id="buttons">
        <button class="btn" onclick="checkFreighter()">
          1. Check Freighter
        </button>
        <button class="btn" onclick="connectWallet()" id="connectBtn">
          2. Connect Wallet
        </button>
        <button class="btn" onclick="getWalletInfo()" id="infoBtn" disabled>
          3. Get Wallet Info
        </button>
      </div>

      <div id="walletInfo" style="display: none"></div>
    </div>

    <script>
      let isConnected = false;
      let walletData = null;

      function log(message, type = "info") {
        const statusDiv = document.getElementById("status");
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = `[${timestamp}] ${message}\n`;

        statusDiv.innerHTML += `<span class="${type}">${logEntry}</span>`;
        statusDiv.scrollTop = statusDiv.scrollHeight;
        console.log(logEntry);
      }

      function clearLog() {
        document.getElementById("status").innerHTML = "";
      }

      async function checkFreighter() {
        clearLog();
        log("üîç Checking for Freighter wallet...", "info");

        // Check if Freighter is installed
        if (typeof window.freighter === "undefined") {
          log("‚ùå Freighter wallet not found!", "error");
          log("üì• Please install Freighter extension:", "warning");
          log(
            "https://chrome.google.com/webstore/detail/freighter/bcacfldlkkdogcmkkibnjlakofdplcbk",
            "info"
          );

          const install = confirm(
            "Freighter not found. Open installation page?"
          );
          if (install) {
            window.open(
              "https://chrome.google.com/webstore/detail/freighter/bcacfldlkkdogcmkkibnjlakofdplcbk",
              "_blank"
            );
          }
          return false;
        }

        log("‚úÖ Freighter wallet detected!", "success");

        // Check available methods
        const methods = [
          "isConnected",
          "getPublicKey",
          "requestAccess",
          "isAllowed",
          "getNetwork",
        ];
        for (const method of methods) {
          if (typeof window.freighter[method] === "function") {
            log(`‚úÖ Method ${method} available`, "success");
          } else {
            log(`‚ùå Method ${method} missing`, "error");
          }
        }

        // Check if already connected
        try {
          const isAllowed = await window.freighter.isAllowed();
          if (isAllowed) {
            log("üîó Already connected to Freighter!", "success");
            const publicKey = await window.freighter.getPublicKey();
            if (publicKey) {
              log(`üìã Public Key: ${publicKey}`, "success");
              isConnected = true;
              walletData = { publicKey, walletType: "freighter" };
              updateUI();
            }
          } else {
            log(
              'üîê Not connected yet. Click "Connect Wallet" to continue.',
              "warning"
            );
          }
        } catch (error) {
          log(`‚ö†Ô∏è Connection check error: ${error.message}`, "warning");
        }

        return true;
      }

      async function connectWallet() {
        if (!window.freighter) {
          log("‚ùå Please check Freighter installation first!", "error");
          return;
        }

        log("üîÑ Requesting connection to Freighter...", "info");

        try {
          // Request access
          log("üîê Requesting wallet access...", "info");
          await window.freighter.requestAccess();

          log("‚úÖ Access granted!", "success");

          // Verify connection
          const isAllowed = await window.freighter.isAllowed();
          if (!isAllowed) {
            throw new Error("Access was not granted");
          }

          // Get public key
          log("üìã Getting public key...", "info");
          const publicKey = await window.freighter.getPublicKey();

          if (!publicKey) {
            throw new Error("No public key returned");
          }

          // Get network
          const network = await window.freighter.getNetwork();

          log("üéâ Successfully connected!", "success");
          log(`üìã Public Key: ${publicKey}`, "success");
          log(`üåê Network: ${network}`, "success");

          isConnected = true;
          walletData = {
            publicKey,
            network,
            walletType: "freighter",
            connectedAt: new Date().toISOString(),
          };

          updateUI();
        } catch (error) {
          log(`‚ùå Connection failed: ${error.message}`, "error");

          if (error.message.includes("User declined access")) {
            log(
              "üí° Please approve the connection request in Freighter",
              "warning"
            );
          } else if (error.message.includes("No account")) {
            log(
              "üí° Please create or import an account in Freighter",
              "warning"
            );
          }
        }
      }

      async function getWalletInfo() {
        if (!isConnected || !walletData) {
          log("‚ùå Wallet not connected!", "error");
          return;
        }

        log("üìä Getting detailed wallet information...", "info");

        try {
          const publicKey = await window.freighter.getPublicKey();
          const network = await window.freighter.getNetwork();
          const isAllowed = await window.freighter.isAllowed();

          const walletInfoDiv = document.getElementById("walletInfo");
          walletInfoDiv.innerHTML = `
                    <div class="connected">
                        <h3>üöÄ Connected Wallet Information</h3>
                        <p><strong>Public Key:</strong> ${publicKey}</p>
                        <p><strong>Short Address:</strong> ${publicKey.slice(
                          0,
                          6
                        )}...${publicKey.slice(-4)}</p>
                        <p><strong>Network:</strong> ${network}</p>
                        <p><strong>Status:</strong> Connected ‚úÖ</p>
                        <p><strong>Wallet Type:</strong> Freighter</p>
                        <p><strong>Connected At:</strong> ${
                          walletData.connectedAt
                        }</p>
                    </div>
                `;
          walletInfoDiv.style.display = "block";

          log("‚úÖ Wallet information retrieved successfully!", "success");
        } catch (error) {
          log(`‚ùå Failed to get wallet info: ${error.message}`, "error");
        }
      }

      function updateUI() {
        const connectBtn = document.getElementById("connectBtn");
        const infoBtn = document.getElementById("infoBtn");

        if (isConnected) {
          connectBtn.textContent = "‚úÖ Connected";
          connectBtn.disabled = true;
          infoBtn.disabled = false;
        } else {
          connectBtn.textContent = "2. Connect Wallet";
          connectBtn.disabled = false;
          infoBtn.disabled = true;
        }
      }

      // Auto-check on page load
      window.addEventListener("load", () => {
        setTimeout(checkFreighter, 1000);
      });

      // Check for Freighter every 3 seconds if not connected
      setInterval(() => {
        if (!isConnected && !window.freighter) {
          checkFreighter();
        }
      }, 3000);
    </script>
  </body>
</html>
